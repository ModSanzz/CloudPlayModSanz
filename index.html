<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudPlay / DPMods Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --primary:#C77DFF; /* Ungu neon */
  --bg:#121212;
  --card:#1e1e1e;
  --text:#fff;
  --muted:#aaa;
  --valid:#4caf50;
  --expired:#ff4d4d;
}
body{margin:0;font-family:Roboto;background:var(--bg);color:var(--text);padding-bottom:80px;}
header{padding:15px;text-align:center;background:#1a1a1a;box-shadow:0 2px 5px rgba(0,0,0,.5);}
h1{margin:0;color:var(--primary);}
.container{padding:15px;max-width:900px;margin:auto;}
.search{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.search input{flex:1;padding:8px;border-radius:6px;border:none;background:#333;color:#fff;}
.search button{background:var(--primary);color:#000;border:none;padding:8px 12px;border-radius:6px;font-weight:700;cursor:pointer;}
.filters{display:flex;gap:10px;margin-bottom:10px;}
.filters button{padding:5px 12px;border-radius:6px;border:none;cursor:pointer;background:#333;color:#fff;}
.filters button.active{background:var(--primary);color:#000;}
.card{background:var(--card);border-radius:8px;padding:12px 15px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;position:relative;}
.card .status{position:absolute;top:10px;left:10px;padding:2px 6px;border-radius:4px;font-size:12px;font-weight:700;color:#fff;}
.card.valid .status{background:var(--valid);}
.card.expired .status{background:var(--expired);}
.card .info{margin-left:0;}
.card .actions button{background:none;border:none;color:#fff;font-size:16px;cursor:pointer;margin-left:5px;}
nav{position:fixed;bottom:0;left:0;right:0;height:60px;background:#1a1a1a;display:flex;justify-content:space-around;align-items:center;}
nav div{text-align:center;color:#aaa;cursor:pointer;}
nav .active{color:var(--primary);}
#addBtn{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:60px;height:60px;border-radius:50%;background:#4caf50;color:#fff;font-size:30px;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 0 10px rgba(0,255,0,.5);}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;}
.modal-box{background:var(--card);padding:20px;border-radius:10px;width:90%;max-width:400px;}
.modal-box h3{margin-top:0;}
.modal-box input, .modal-box textarea{width:100%;padding:8px;margin-top:5px;border-radius:6px;background:#333;border:1px solid #555;color:#fff;}
.date-shortcuts{display:flex;gap:5px;margin-top:5px;margin-bottom:10px;}
.date-shortcuts button{background:#333;color:#fff;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;flex-shrink:0;}
.date-shortcuts button:hover{background:#444;}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#000;padding:10px 20px;border-radius:20px;display:none;}
</style>
</head>
<body>

<header><h1>CloudPlay / DPMods Admin</h1></header>

<div class="container">
  <div class="search">
    <input id="searchInput" placeholder="Cari Build ID..." oninput="render()">
  </div>
  <div class="filters">
    <button id="filterAll" class="active" onclick="setFilter('all')">ALL (0)</button>
    <button id="filterValid" onclick="setFilter('valid')">VALID (0)</button>
    <button id="filterExpired" onclick="setFilter('expired')">EXPIRED (0)</button>
  </div>
  <div id="list"></div>
</div>

<div id="addBtn" onclick="openModal()">+</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Tambah / Edit ID</h3>
    <input id="idInput" placeholder="Build / Device ID">
    <input id="userInput" placeholder="Username">
    <label>Tanggal Kadaluarsa</label>
    <div class="date-shortcuts">
      <button onclick="setExpiry(1)">+1 Hari</button>
      <button onclick="setExpiry(7)">+7 Hari</button>
      <button onclick="setExpiry(30)">+30 Hari</button>
      <button onclick="setExpiry(90)">+3 Bulan</button>
    </div>
    <input type="date" id="dateInput">
    <br><br>
    <button style="background:var(--primary);color:#000;padding:8px 12px;border:none;border-radius:6px;" onclick="saveID()">Simpan</button>
    <button style="background:var(--expired);color:#fff;padding:8px 12px;border:none;border-radius:6px;" onclick="closeModal()">Batal</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const FIREBASE_ROOT="https://cloudplaypaneladmin-default-rtdb.asia-southeast1.firebasedatabase.app";
const KEYS_URL=FIREBASE_ROOT+"/keys.json";

let data={}, editId=null, filter="all";

const $=id=>document.getElementById(id);
function toast(msg){const t=$('toast'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2500);}

async function load(){
  const r=await fetch(KEYS_URL);
  data=await r.json()||{};
  render();
}
function isExpired(date){if(!date) return true; const today=new Date(); today.setHours(0,0,0,0); return new Date(date)<today;}
function setFilter(f){filter=f; render();}
function render(){
  const list=$('list');
  list.innerHTML='';
  let all=0,valid=0,expired=0;
  Object.keys(data).forEach(id=>{
    const d=data[id];
    const exp=isExpired(d.date);
    if(id==="MAINTENANCE") return;
    if(filter==='valid' && exp) return;
    if(filter==='expired' && !exp) return;
    all++; if(exp) expired++; else valid++;
    list.innerHTML+=`<div class="card ${exp?'expired':'valid'}">
      <span class="status">${exp?'EXPIRED':'VALID'}</span>
      <div class="info"><strong>${id}</strong><br>Expires: ${d.date||'-'}<br>Username: ${d.username||'-'}</div>
      <div class="actions">
        <button onclick="edit('${id}')"><i class="fa fa-pen"></i></button>
        <button onclick="del('${id}')"><i class="fa fa-trash"></i></button>
      </div>
    </div>`;
  });
  $('filterAll').innerText=`ALL (${all})`;
  $('filterValid').innerText=`VALID (${valid})`;
  $('filterExpired').innerText=`EXPIRED (${expired})`;
  document.querySelectorAll('.filters button').forEach(b=>b.classList.remove('active'));
  if(filter==='all') $('filterAll').classList.add('active');
  if(filter==='valid') $('filterValid').classList.add('active');
  if(filter==='expired') $('filterExpired').classList.add('active');
}

function openModal(){
  editId=null; $('idInput').value=''; $('userInput').value=''; $('dateInput').value=''; $('modal').style.display='flex';
}
function closeModal(){ $('modal').style.display='none'; }
function setExpiry(days){const d=new Date(); d.setDate(d.getDate()+days); $('dateInput').value=d.toISOString().split('T')[0];}
function edit(id){editId=id; $('idInput').value=id; $('userInput').value=data[id].username||''; $('dateInput').value=data[id].date||''; $('modal').style.display='flex';}

async function saveID(){
  const id=$('idInput').value.trim(); const user=$('userInput').value.trim(); const date=$('dateInput').value;
  if(!id||!user||!date){toast("ISI SEMUA!");return;}
  data[id]={username:user,date:date};
  await fetch(KEYS_URL,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({[id]:data[id]})});
  load(); closeModal(); toast("Tersimpan");
}

async function del(id){
  if(confirm("Hapus "+id+" ?")){
    await fetch(KEYS_URL,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({[id]:null})});
    load(); toast("Dihapus");
  }
}

load();
</script>
</body>
</html>

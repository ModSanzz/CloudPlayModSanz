<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cloudplay / DPMods Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
--primary:#C77DFF;--bg:#121212;--card:#1f1f1f;--text:#fff;--muted:#aaa;--danger:#ff4d4d;
}
body{margin:0;font-family:Roboto;background:var(--bg);color:var(--text);padding-bottom:70px}
header{text-align:center;padding:15px;background:var(--card)}
.container{max-width:900px;margin:auto;padding:20px}
.search-bar{display:flex;gap:8px}
.search-bar input{flex:1;padding:10px;background:#333;color:#fff;border-radius:6px;border:1px solid #444}
.search-bar button{padding:10px 14px;border:none;border-radius:6px;background:var(--primary)}
.filter-bar{display:flex;gap:8px;margin:15px 0;overflow-x:auto}
.filter-bar button{background:#333;color:#aaa;border:none;padding:6px 14px;border-radius:20px}
.filter-bar button.active{background:var(--primary);color:#000}
.user-item{background:var(--card);padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;border-left:5px solid}
.user-item.valid{border-color:var(--primary)}
.user-item.expired{border-color:var(--danger)}
.user-status{font-weight:700;margin-right:10px}
nav{position:fixed;bottom:0;left:0;right:0;height:60px;background:var(--card);display:flex;justify-content:space-around;align-items:center}
.add-btn{width:55px;height:55px;border-radius:50%;background:var(--primary);display:flex;align-items:center;justify-content:center;font-size:24px;color:#000}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center}
.modal-content{background:var(--card);padding:20px;border-radius:10px;width:90%;max-width:420px}
input,textarea{width:100%;padding:10px;background:#333;color:#fff;border-radius:6px;border:1px solid #444;margin-top:8px}
button{cursor:pointer}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#000;padding:10px 20px;border-radius:20px;opacity:0;transition:.3s}
.toast.show{opacity:1}
</style>
</head>
<body>

<header><h2>Cloudplay / DPMods Admin</h2></header>

<div class="container">
<div class="search-bar">
<input id="search" placeholder="Cari Build ID">
<button onclick="render()">üîç</button>
</div>

<div class="filter-bar">
<button class="active" onclick="setFilter('all',this)">ALL</button>
<button onclick="setFilter('valid',this)">VALID</button>
<button onclick="setFilter('expired',this)">EXPIRED</button>
</div>

<div id="list"></div>
</div>

<nav>
<div onclick="showSettings()">‚öôÔ∏è</div>
<div class="add-btn" onclick="openAdd()">+</div>
<div onclick="showList()">üìÑ</div>
</nav>

<!-- ADD / EDIT -->
<div class="modal" id="modal">
<div class="modal-content">
<h3 id="modalTitle">Add ID</h3>
<input id="build">
<input id="date" type="date">
<div style="margin-top:10px;text-align:right">
<button onclick="closeModal()">Batal</button>
<button onclick="saveID()">Simpan</button>
</div>
</div>
</div>

<!-- PASSWORD -->
<div class="modal" id="passModal">
<div class="modal-content">
<h3>Password Admin</h3>
<input type="password" id="pass">
<div style="margin-top:10px;text-align:right">
<button onclick="closePass()">Batal</button>
<button onclick="submitPass()">OK</button>
</div>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
const WORKER_URL="https://adminku.sannafanity.workers.dev/";
let RAW=[],DATA=[],FILTER="all",EDIT=null;

const $=e=>document.getElementById(e);
const toast=t=>{$("toast").textContent=t;$("toast").classList.add("show");setTimeout(()=>{$("toast").classList.remove("show")},3000)}

const expired=d=>new Date(d)<new Date().setHours(0,0,0,0)

function setFilter(f,el){FILTER=f;document.querySelectorAll(".filter-bar button").forEach(b=>b.classList.remove("active"));el.classList.add("active");render()}

function render(){
const list=$("list");list.innerHTML=""
DATA=RAW.filter(i=>i.build_id!=="MAINTENANCE")
.filter(i=>{
if(FILTER==="valid")return !expired(i.date)
if(FILTER==="expired")return expired(i.date)
return true
})
.filter(i=>i.build_id.toLowerCase().includes($("search").value.toLowerCase()))

DATA.forEach((i,idx)=>{
const d=document.createElement("div")
d.className=`user-item ${expired(i.date)?"expired":"valid"}`
d.innerHTML=`<div><b>${i.build_id}</b><br>${i.date}</div>
<div>
<button onclick="edit(${idx})">‚úèÔ∏è</button>
<button onclick="del(${idx})">üóë</button>
</div>`
list.appendChild(d)
})
}

function openAdd(){EDIT=null;$("build").value="";$("date").value="";$("modal").style.display="flex"}
function closeModal(){$("modal").style.display="none"}

function edit(i){EDIT=i;$("build").value=DATA[i].build_id;$("date").value=DATA[i].date;$("modal").style.display="flex"}

function del(i){
if(confirm("Hapus?")){
RAW=RAW.filter(r=>r.build_id!==DATA[i].build_id)
save()
}
}

function saveID(){
const b=$("build").value.trim(),d=$("date").value
if(!b||!d)return toast("Lengkapi data")
if(EDIT!==null) RAW=RAW.map(r=>r.build_id===DATA[EDIT].build_id?{build_id:b,date:d}:r)
else RAW.push({build_id:b,date:d})
closeModal();save()
}

function save(){
$("passModal").style.display="flex"
}

function closePass(){$("passModal").style.display="none"}
function submitPass(){
const p=$("pass").value
fetch(WORKER_URL,{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({admin_password:p,data:RAW})})
.then(r=>r.json()).then(j=>{
if(j.success){toast("Tersimpan");load()}
else toast("Gagal simpan")
})
closePass()
}

function load(){
fetch(WORKER_URL,{cache:"no-store"}).then(r=>r.json()).then(j=>{
RAW=j.data||[]
render()
toast("Data dimuat")
})
}

load()
</script>
</body>
</html>

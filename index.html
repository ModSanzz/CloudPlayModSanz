<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudPlay Admin Panel</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
:root{
  --primary:#C77DFF;
  --bg:#121212;
  --text:#fff;
  --muted:#aaa;
  --valid:#4caf50;
  --expired:#ff4d4d;
}
body{
  margin:0;
  font-family:Roboto,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.header{
  text-align:center;
  font-size:1.8rem;
  padding:16px;
  color:var(--primary);
  text-shadow:0 0 8px var(--primary);
}
.search-bar{
  display:flex;
  justify-content:center;
  padding:10px;
}
.search-bar input{
  width:60%;
  padding:8px;
  border-radius:8px;
  border:none;
  outline:none;
  background:#282828;
  color:#fff;
}
.search-bar button{
  margin-left:8px;
  background:var(--primary);
  border:none;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
}
.filter-bar{
  display:flex;
  justify-content:center;
  gap:8px;
  overflow-x:auto;
  padding:10px;
}
.filter-bar button{
  padding:8px 12px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  background:#333;
  color:var(--muted);
}
.filter-bar button.active{
  background:var(--primary);
  color:#fff;
}
.user-item{
  background:#282828;
  padding:16px 20px;
  margin:10px 16px;
  border-radius:14px;
}
.user-id, .user-expire{
  margin-bottom:6px;
}
.user-row{
  display:flex;
  align-items:center;
  gap:12px;
}
.status.valid{
  background:var(--valid);
  color:#fff;
  padding:2px 8px;
  border-radius:6px;
  font-size:0.8rem;
}
.status.expired{
  background:var(--expired);
  color:#fff;
  padding:2px 8px;
  border-radius:6px;
  font-size:0.8rem;
}
button.edit, button.delete{
  border:none;
  background:none;
  cursor:pointer;
  font-size:1rem;
}
button.edit i{ color:#aaa; }
button.delete i{ color:#ff4d4d; }
.add-btn{
  position:fixed;
  bottom:25px;
  left:50%;
  transform:translateX(-50%);
  background:var(--primary);
  border:none;
  border-radius:50%;
  width:70px;
  height:70px;
  font-size:2rem;
  color:#fff;
  cursor:pointer;
  box-shadow:0 0 12px var(--primary);
}
.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content{
  background:#282828;
  padding:22px;
  border-radius:14px;
  width:90%;
  max-width:450px;
}
.modal h2{
  color:var(--primary);
  margin-top:0;
}
.modal input, .modal textarea{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:none;
  background:#333;
  color:#fff;
}
.modal .shortcuts{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:6px 0;
}
.modal .shortcuts button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#444;
  color:#fff;
}
.modal .shortcuts button:hover{background:var(--primary);}
.modal .modal-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:12px;
}
.modal .modal-actions button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
.modal .save-btn{background:var(--primary); color:#fff;}
.modal .cancel-btn{background:#444; color:#fff;}
#toast{
  position:fixed;
  bottom:100px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.8);
  color:#fff;
  padding:10px 20px;
  border-radius:20px;
  opacity:0;
  transition:opacity 0.3s;
  z-index:2000;
}
#toast.show{opacity:1;}
@media screen and (max-width:500px){
  .user-item{margin:10px 10px;}
  .user-row{flex-wrap:wrap;}
  .search-bar input{width:65%;}
}
</style>
</head>
<body>

<div class="header">CloudPlay Admin Panel</div>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search ID...">
  <button id="searchBtn"><i class="fa fa-search"></i></button>
</div>

<div class="filter-bar">
  <button class="active" data-filter="all" onclick="setFilter(this)">All</button>
  <button data-filter="valid" onclick="setFilter(this)">Valid</button>
  <button data-filter="expired" onclick="setFilter(this)">Expired</button>
</div>

<div id="user-list"></div>

<button class="add-btn" onclick="openModal()"><i class="fa fa-plus"></i></button>

<div class="modal" id="userModal">
  <div class="modal-content">
    <h2 id="modalTitle">Add ID</h2>
    <input type="text" id="buildIdInput" placeholder="ID...">
    <input type="text" id="usernameInput" placeholder="User...">
    <label>Expire</label>
    <div class="shortcuts">
      <button onclick="setExpiry(1)">+1 Hari</button>
      <button onclick="setExpiry(7)">+7 Hari</button>
      <button onclick="setExpiry(30)">+1 Bulan</button>
      <button onclick="setExpiry(90)">+3 Bulan</button>
      <button onclick="setExpiry(365)">+1 Tahun</button>
      <button onclick="setPermanent()">Permanent</button>
    </div>
    <input type="date" id="expiryDateInput">
    <div class="modal-actions">
      <button class="cancel-btn" onclick="closeModal()">Cancel</button>
      <button class="save-btn" id="saveBtn">Save</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
const FIREBASE_ROOT="https://cloudplaypaneladmin-default-rtdb.asia-southeast1.firebasedatabase.app";
const DB=FIREBASE_ROOT+"/keys.json";
let data={},filter="all",editKey=null;
const $=i=>document.getElementById(i);
function toastMsg(t){$('toast').textContent=t;$('toast').classList.add('show');setTimeout(()=>{$('toast').classList.remove('show');},2000);}
function isExpired(d){return d!=="9999-12-31" && new Date(d)<new Date(new Date().toDateString());}
async function load(){try{data=await(await fetch(DB)).json()||{};}catch(e){data={};}render();}
load();

function setFilter(btn){
  document.querySelectorAll('.filter-bar button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  filter=btn.dataset.filter;
  render();
}

function render(){
  const l=$('user-list'); l.innerHTML="";
  Object.keys(data).forEach(k=>{
    const d=data[k]; const exp=isExpired(d.date);
    if(filter==="valid"&&exp) return; if(filter==="expired"&&!exp) return;
    if(!$('searchInput').value || k.toLowerCase().includes($('searchInput').value.toLowerCase()) || (d.username||"").toLowerCase().includes($('searchInput').value.toLowerCase())){
      const div=document.createElement('div');
      div.className="user-item";
      div.innerHTML=`<div class="user-id">ID : ${k}</div>
        <div class="user-row">
          User : ${d.username||'-'}
          <span class="status ${exp?'expired':'valid'}">${exp?'EXPIRED':'VALID'}</span>
          <button class="edit" onclick="editID('${k}')"><i class="fa fa-pencil"></i></button>
          <button class="delete" onclick="delID('${k}')"><i class="fa fa-trash"></i></button>
        </div>
        <div class="user-expire">Expire : ${d.date==="9999-12-31"?'Permanent':d.date}</div>`;
      l.appendChild(div);
    }
  });
}

function openModal(){editKey=null;$('modalTitle').textContent="Add ID";$('buildIdInput').value="";$('usernameInput').value="";$('expiryDateInput').value="";$('userModal').style.display="flex";}
function closeModal(){$('userModal').style.display="none";}
function editID(k){editKey=k;const d=data[k];$('modalTitle').textContent="Edit ID";$('buildIdInput').value=k;$('buildIdInput').disabled=true;$('usernameInput').value=d.username||"";$('expiryDateInput').value=d.date;$('userModal').style.display="flex";}
function setExpiry(days){let dt=new Date();dt.setDate(dt.getDate()+days);$('expiryDateInput').value=dt.toISOString().split('T')[0];}
function setPermanent(){$('expiryDateInput').value="9999-12-31";}
async function saveID(){
  const id=$('buildIdInput').value.trim(), user=$('usernameInput').value.trim(), date=$('expiryDateInput').value;
  if(!id||!date){toastMsg('ID & Expire wajib diisi!');return;}
  const key=editKey||id; data[key]={username:user,date:date}; $('buildIdInput').disabled=false; closeModal(); toastMsg('Saved'); render();
  await fetch(DB,{method:"PUT",headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
}
$('saveBtn').onclick=saveID;
async function delID(k){if(!confirm("Delete ID?"))return; delete data[k]; toastMsg('Deleted'); render(); await fetch(DB,{method:"PUT",headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});}
$('searchBtn').onclick=render;
$('searchInput').addEventListener('keyup', e=>{if(e.key==='Enter') render();});
</script>

</body>
</html>

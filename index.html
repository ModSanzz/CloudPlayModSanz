<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudPlay Admin Panel</title>
<style>
  body { margin:0; font-family:sans-serif; background:#121212; color:#fff; }
  header { text-align:center; padding:20px; font-size:1.5rem; color:#C77DFF; font-weight:bold; }
  .container { padding:15px; }
  input[type=text]{ width:calc(100% - 45px); padding:8px; border-radius:5px; border:none; }
  button.search-btn { width:40px; background:#C77DFF; border:none; border-radius:5px; color:#fff; cursor:pointer; }
  .filters { margin:10px 0; }
  .filters button { margin-right:5px; border:none; padding:5px 12px; border-radius:20px; background:#444; color:#fff; cursor:pointer; }
  .filters button.active { background:#C77DFF; }
  .id-card { background:#1e1e1e; padding:10px; margin-bottom:10px; border-radius:10px; position:relative; border-left:4px solid #C77DFF; }
  .id-card h4, .id-card p { margin:5px 0; }
  .status-btn { display:inline-block; padding:4px 10px; font-size:0.85rem; font-weight:700; border-radius:6px; margin-top:5px; }
  .valid { background:#4caf50; color:#fff; }
  .expired { background:#f44336; color:#fff; }
  .actions { position:absolute; right:10px; bottom:10px; display:flex; gap:8px; }
  .actions button { background:#222; border:none; color:#fff; padding:4px 6px; border-radius:5px; cursor:pointer; }
  .actions button.edit { background:#555; }
  .actions button.delete { background:#f44336; }
  footer { position:fixed; bottom:0; width:100%; display:flex; justify-content:space-around; padding:10px 0; background:#1a1a1a; }
  footer button { background:#C77DFF; border:none; border-radius:50%; width:50px; height:50px; font-size:1.5rem; color:#fff; cursor:pointer; }
  footer button#ids { width:50px; height:50px; border-radius:50%; }
</style>
</head>
<body>

<header>CloudPlay Admin Panel</header>

<div class="container">
  <div style="display:flex; margin-bottom:10px;">
    <input type="text" id="searchInput" placeholder="Search Build/Device ID...">
    <button class="search-btn" onclick="renderList()">üîç</button>
  </div>

  <div class="filters">
    <button id="filterAll" class="active" onclick="setFilter('all')">All <span id="countAll">(0)</span></button>
    <button id="filterValid" onclick="setFilter('valid')">Valid <span id="countValid">(0)</span></button>
    <button id="filterExpired" onclick="setFilter('expired')">Expired <span id="countExpired">(0)</span></button>
  </div>

  <div id="listContainer"></div>
</div>

<footer>
  <button id="ids">üîë</button>
  <button id="add" onclick="addNew()">+</button>
  <button id="status">üîî</button>
</footer>

<script>
const FIREBASE_ROOT = "https://cloudplaypaneladmin-default-rtdb.asia-southeast1.firebasedatabase.app";
const KEYS_URL = FIREBASE_ROOT + "/keys.json";

let data = {};
let currentFilter = 'all';

function $(id){ return document.getElementById(id); }

async function fetchData(){
  try {
    const r = await fetch(KEYS_URL);
    data = await r.json();
    updateCounts();
    renderList();
  } catch(e){ console.log(e); }
}

function isExpired(dateStr){
  return new Date(dateStr) < new Date();
}

function updateCounts(){
  let total=0, valid=0, expired=0; 
  Object.keys(data).forEach(id=>{
    if(id==="MAINTENANCE") return;
    total++; 
    if(isExpired(data[id].date)) expired++; else valid++;
  }); 
  $('countAll').textContent=`(${total})`; 
  $('countValid').textContent=`(${valid})`; 
  $('countExpired').textContent=`(${expired})`;
}

function setFilter(f){
  currentFilter=f;
  ['filterAll','filterValid','filterExpired'].forEach(id=>$(id).classList.remove('active'));
  $(f==='all'?'filterAll':f==='valid'?'filterValid':'filterExpired').classList.add('active');
  renderList();
}

function renderList(){
  const container = $('listContainer');
  container.innerHTML='';
  const searchTerm = $('searchInput').value.toLowerCase();
  Object.keys(data).forEach(id=>{
    if(id==="MAINTENANCE") return;
    const item = data[id];
    if(searchTerm && !id.toLowerCase().includes(searchTerm)) return;
    let status = isExpired(item.date) ? 'expired' : 'valid';
    if(currentFilter==='valid' && status!=='valid') return;
    if(currentFilter==='expired' && status!=='expired') return;
    const card = document.createElement('div');
    card.className='id-card';
    card.innerHTML = `
      <h4>${id}</h4>
      <p>User : ${item.user}</p>
      <p>Expires : ${item.date}</p>
      <div class="status-btn ${status}">${status.toUpperCase()}</div>
      <div class="actions">
        <button class="edit" onclick="editID('${id}')">‚úèÔ∏è</button>
        <button class="delete" onclick="deleteID('${id}')">üóëÔ∏è</button>
      </div>
    `;
    container.appendChild(card);
  });
}

function addNew(){ alert('Fungsi Add New ID belum diimplement'); }
function editID(id){ alert('Edit ID '+id); }
function deleteID(id){ alert('Delete ID '+id); }

fetchData();
</script>

</body>
</html>

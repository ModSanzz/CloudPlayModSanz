<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DPMods Build ID Admin Panel</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===== UI TIDAK DIUBAH ===== */
:root{
--primary:#1DB954;
--bg:#121212;
--card:#282828;
--text:#fff;
--muted:#aaa;
--danger:#ff4d4d;
--glow:0 0 8px rgba(29,185,84,.6);
}
body{margin:0;font-family:Roboto;background:var(--bg);color:var(--text);padding-bottom:70px}
header{background:var(--card);padding:15px;text-align:center;box-shadow:0 2px 5px #000}
.container{max-width:900px;margin:auto;padding:20px}
.search-bar{display:flex;gap:10px;margin-bottom:15px}
.search-bar input{flex:1;padding:10px;border-radius:6px;border:1px solid #444;background:#333;color:#fff}
.search-bar button{background:var(--primary);border:none;padding:10px 15px;border-radius:6px;cursor:pointer}
.filter-bar{display:flex;gap:10px;margin-bottom:15px;overflow-x:auto}
.filter-bar button{background:#333;border:none;padding:6px 14px;border-radius:20px;color:var(--muted)}
.filter-bar button.active{background:var(--primary);color:#000}
.user-item{background:var(--card);padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;border-left:5px solid transparent}
.user-item.valid{border-left-color:var(--primary)}
.user-item.expired{border-left-color:var(--danger);background:#331f1f}
.user-status-tag{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:700;margin-right:10px}
.user-item.valid .user-status-tag{background:var(--primary);color:#000}
.user-item.expired .user-status-tag{background:var(--danger)}
.user-actions button{background:none;border:none;color:#aaa;font-size:18px;cursor:pointer}
nav{position:fixed;bottom:0;left:0;right:0;height:60px;background:var(--card);display:flex;justify-content:space-around;align-items:center}
.nav-item{color:var(--muted);cursor:pointer;text-align:center}
.nav-item.active{color:var(--primary)}
.add-user-btn{width:56px;height:56px;border-radius:50%;background:var(--primary);display:flex;justify-content:center;align-items:center;font-size:24px;color:#000;transform:translateY(-15px);box-shadow:var(--glow)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:2000}
.modal-content{background:var(--card);padding:25px;border-radius:12px;width:90%;max-width:420px}
input,textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #444;background:#333;color:#fff}
.btn{padding:10px 15px;border:none;border-radius:6px;font-weight:700}
.btn-primary{background:var(--primary);color:#000}
.btn-secondary{background:#444;color:#fff}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#000;padding:10px 20px;border-radius:20px;opacity:0;transition:.3s}
.toast.show{opacity:1}
</style>
</head>

<body>

<header><h1>DPMods Build ID Management</h1></header>

<div class="container">
<div id="usersTab">
<div class="search-bar">
<input id="searchInput" placeholder="Search Build ID">
<button onclick="renderIDs()"><i class="fa fa-search"></i></button>
</div>

<div class="filter-bar">
<button class="active" onclick="setFilter('all',this)">ALL <span id="count-all"></span></button>
<button onclick="setFilter('valid',this)">VALID <span id="count-valid"></span></button>
<button onclick="setFilter('expired',this)">EXPIRED <span id="count-expired"></span></button>
</div>

<div id="userList"></div>
</div>

<div id="settingsTab" style="display:none">
<h3>Status Global</h3>
<label>
<input type="checkbox" id="maintenanceToggle">
Maintenance
</label>
<textarea id="maintenanceMessage" placeholder="Maintenance message"></textarea>
<br><br>
<button class="btn btn-primary" onclick="saveMaintenance()">Save</button>
</div>
</div>

<nav>
<div class="nav-item active" onclick="showTab('users')" id="navUsers"><i class="fa fa-key"></i><br>IDs</div>
<div class="add-user-btn" onclick="openModal()"><i class="fa fa-plus"></i></div>
<div class="nav-item" onclick="showTab('settings')" id="navSettings"><i class="fa fa-gear"></i><br>Status</div>
</nav>

<div class="modal" id="userModal">
<div class="modal-content">
<h3 id="modalTitle">Add ID</h3>
<input id="buildInput" placeholder="Build ID">
<input type="date" id="dateInput">
<br><br>
<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
<button class="btn btn-primary" onclick="saveID()">Save</button>
</div>
</div>

<div class="modal" id="passwordModal">
<div class="modal-content">
<h3>Admin Password</h3>
<input type="password" id="adminPassword">
<br><br>
<button class="btn btn-secondary" onclick="closePassword()">Cancel</button>
<button class="btn btn-primary" onclick="saveToWorker()">Confirm</button>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ================= CONFIG ================= */
const WORKER_URL = "https://adminku.sannafanity.workers.dev"; // ⬅️ GANTI
let data=[],filter='all',editIndex=null;

/* ================= UTIL ================= */
const $=id=>document.getElementById(id);
const toast=t=>{$('toast').textContent=t;$('toast').classList.add('show');setTimeout(()=>{$('toast').classList.remove('show')},3000);}
const expired=d=>new Date(d)<new Date().setHours(0,0,0,0);

/* ================= LOAD ================= */
async function load(){
const r=await fetch(WORKER_URL,{cache:'no-store'});
const j=await r.json();
data=j.data||j;
renderIDs();
}
load();

/* ================= UI ================= */
function showTab(t){
usersTab.style.display=t==='users'?'block':'none';
settingsTab.style.display=t==='settings'?'block':'none';
navUsers.classList.toggle('active',t==='users');
navSettings.classList.toggle('active',t==='settings');
}

function setFilter(f,b){
filter=f;
document.querySelectorAll('.filter-bar button').forEach(x=>x.classList.remove('active'));
b.classList.add('active');
renderIDs();
}

/* ================= CRUD ================= */
function renderIDs(){
userList.innerHTML='';
let list=data.filter(x=>x.build_id!=="MAINTENANCE");
if(filter==='valid')list=list.filter(x=>!expired(x.date));
if(filter==='expired')list=list.filter(x=>expired(x.date));
list.forEach((x,i)=>{
const d=document.createElement('div');
d.className='user-item '+(expired(x.date)?'expired':'valid');
d.innerHTML=`
<div>
<span class="user-status-tag">${expired(x.date)?'EXPIRED':'VALID'}</span>
<b>${x.build_id}</b><br>${x.date}
</div>
<div class="user-actions">
<button onclick="editID(${i})"><i class="fa fa-edit"></i></button>
<button onclick="delID(${i})"><i class="fa fa-trash"></i></button>
</div>`;
userList.appendChild(d);
});
$('count-all').textContent=`(${list.length})`;
$('count-valid').textContent=`(${list.filter(x=>!expired(x.date)).length})`;
$('count-expired').textContent=`(${list.filter(x=>expired(x.date)).length})`;
}

function openModal(){editIndex=null;userModal.style.display='flex'}
function closeModal(){userModal.style.display='none'}
function editID(i){editIndex=i;buildInput.value=data[i].build_id;dateInput.value=data[i].date;openModal()}
function delID(i){if(confirm('Delete?')){data.splice(i,1);openPassword()}}

function saveID(){
const id=buildInput.value.trim(),d=dateInput.value;
if(!id||!d)return toast('Required');
editIndex!==null?data[editIndex]={build_id:id,date:d}:data.push({build_id:id,date:d});
closeModal();openPassword();
}

/* ================= MAINTENANCE ================= */
function saveMaintenance(){
const obj={build_id:'MAINTENANCE',status:maintenanceToggle.checked?'active':'inactive',message:maintenanceMessage.value};
data=data.filter(x=>x.build_id!=='MAINTENANCE');
data.unshift(obj);
openPassword();
}

/* ================= SAVE ================= */
function openPassword(){passwordModal.style.display='flex'}
function closePassword(){passwordModal.style.display='none'}

async function saveToWorker(){
const pass=$('adminPassword').value;
const r=await fetch(WORKER_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:pass,data})});
const j=await r.json();
j.success?toast('Saved'):toast('Failed');
closePassword();load();
}
</script>
</body>
</html>
